"use strict";function Creature(e,t,a,n,r,o,i){this.creatureHolder=new THREE.Group,this.position=new THREE.Vector3,this.position.set(e||0,t||0,a||0),this.scale=n,this.state=0,this._ribbons=[];var x=createMeshGeom.call(this);this.creatureHolder.add(createParticlesMesh.call(this,x.geometry,r)),this.creatureHolder.add(createTrianglesMesh.call(this,x.geometry,x.indexes,o)),this.creatureHolder.children[1].visible=!1,x.geometry.computeBoundingSphere();var E,m,s=x.geometry.boundingSphere.radius;for(m=0;i>m;m++)E=new Ribbon(s,n),this._ribbons.push(E),this.creatureHolder.add(new THREE.Mesh(E.meshGeom,o))}const createMeshGeom=function(){var e=new THREE.Vector2,t=new THREE.Geometry,a=[];a.push(0);var n=creatingNose(e);t.merge(n),a.push(n.vertices.length),t.computeBoundingBox(),t.computeBoundingSphere(),e.x=t.boundingBox.max.x,e.y=1.5*t.boundingBox.max.y-t.boundingSphere.center.y;var r=-t.boundingBox.max.y+2*t.boundingSphere.center.y,o=creatingEyes(e);t.merge(o);var i=.5*o.vertices.length;a.push(a[a.length-1]+i),a.push(a[a.length-1]+i),t.computeBoundingBox(),e.x=t.boundingBox.max.x,e.y=t.boundingBox.max.y;var x=creatingEars(e);t.merge(x);var E=.5*x.vertices.length;a.push(a[a.length-1]+E),a.push(a[a.length-1]+E),e.y=r;var m=creatingMouth(e);return t.merge(m),a.push(a[a.length-1]+m.vertices.length),t.scale(this.scale,this.scale,this.scale),t.translate(this.position.x,this.position.y,this.position.z),{geometry:t,indexes:a}},creatingNose=function(){var e=new THREE.ConeGeometry(1,1,14,5);e.computeBoundingBox(),e.applyMatrix((new THREE.Matrix4).makeRotationAxis(new THREE.Vector3(0,0,1),Math.PI)),e.applyMatrix((new THREE.Matrix4).makeTranslation(0,.5*-e.boundingBox.max.y,0));var t=new THREE.ConeGeometry(1,1,14,5);t.computeBoundingBox(),t.applyMatrix((new THREE.Matrix4).makeTranslation(0,t.boundingBox.max.y,0));var a=new THREE.BoxGeometry(.75,.75,.75,3,3,3);a.computeBoundingBox(),a.applyMatrix((new THREE.Matrix4).makeTranslation(0,.75*-a.boundingBox.max.y,0));var n=new THREE.SphereGeometry(.5,10,7);n.computeBoundingBox(),n.applyMatrix((new THREE.Matrix4).makeTranslation(0,.5*n.boundingBox.max.y,0));var r=new THREE.CylinderGeometry(.5,.5,1.25,12,7),o=[e,t,a,n,r],i=ATUtil.randomInt(0,o.length-1);return o[0|i]},creatingEyes=function(e){var t=new THREE.ConeGeometry(.5,.5,7,4);t.applyMatrix((new THREE.Matrix4).makeRotationAxis(new THREE.Vector3(0,0,1),Math.PI));var a=new THREE.ConeGeometry(.5,.5,7,4),n=new THREE.BoxGeometry(.5,.5,.5,2,2,2),r=new THREE.SphereGeometry(.25,7,4),o=new THREE.CylinderGeometry(.25,.25,.5,7,5),i=new THREE.CylinderGeometry(.25,.25,.5,7,5);i.applyMatrix((new THREE.Matrix4).makeRotationAxis(new THREE.Vector3(0,0,1),Math.PI/2));var x=new THREE.TorusGeometry(.25,.1,3,12);x.computeBoundingBox(),x.applyMatrix((new THREE.Matrix4).makeTranslation(0,.25*-x.boundingBox.max.y,0));var E=new THREE.TorusGeometry(.25,.1,3,6,Math.PI);E.computeBoundingBox(),E.applyMatrix((new THREE.Matrix4).makeTranslation(0,.5*-E.boundingBox.max.y,0));var m=new THREE.TorusGeometry(.25,.1,3,6,-Math.PI);m.applyMatrix((new THREE.Matrix4).makeTranslation(0,E.boundingBox.max.y,0));var s=new THREE.TorusGeometry(.25,.1,3,12);s.applyMatrix((new THREE.Matrix4).makeRotationAxis(new THREE.Vector3(1,0,0),Math.PI/2));var u=[t,a,n,r,o,i,x,E,m,s],y=ATUtil.randomInt(0,u.length-1),l=u[0|y];l.computeBoundingBox();var T=l.clone();return T.computeBoundingBox(),l.applyMatrix((new THREE.Matrix4).makeTranslation(e.x+.5*l.boundingBox.max.x,e.y+2*l.boundingBox.max.y,0)),T.applyMatrix((new THREE.Matrix4).makeTranslation(-e.x-.5*T.boundingBox.max.x,e.y+2*T.boundingBox.max.y,0)),l.merge(T),l},creatingEars=function(e){var t=new THREE.ConeGeometry(.25,1.5,7,7);t.applyMatrix((new THREE.Matrix4).makeRotationAxis(new THREE.Vector3(0,0,1),-Math.PI/8));var a=new THREE.ConeGeometry(.25,2,7,7);a.applyMatrix((new THREE.Matrix4).makeRotationAxis(new THREE.Vector3(0,0,1),-Math.PI/4*3)),a.computeBoundingBox(),a.applyMatrix((new THREE.Matrix4).makeTranslation(0,-a.boundingBox.max.y,0));var n=new THREE.BoxGeometry(.25,.25,.25,2,2,2);n.applyMatrix((new THREE.Matrix4).makeRotationAxis(new THREE.Vector3(0,0,1),Math.PI/4));var r=new THREE.SphereGeometry(.25,7,5),o=new THREE.CylinderGeometry(.125,.125,.75,7,4);o.applyMatrix((new THREE.Matrix4).makeRotationAxis(new THREE.Vector3(0,0,1),-Math.PI/8));var i=new THREE.CylinderGeometry(.125,.125,1,7,4);i.applyMatrix((new THREE.Matrix4).makeRotationAxis(new THREE.Vector3(0,0,1),-Math.PI/4*3)),i.computeBoundingBox(),i.applyMatrix((new THREE.Matrix4).makeTranslation(0,-i.boundingBox.max.y,0));var x=[t,a,n,r,o,i],E=ATUtil.randomInt(0,x.length-1),m=x[0|E];m.computeBoundingBox();var s=m.clone();return s.computeBoundingBox(),m.applyMatrix((new THREE.Matrix4).makeTranslation(e.x+1.5*m.boundingBox.max.x,e.y+m.boundingBox.max.y,0)),0==E||4==E?(s.applyMatrix((new THREE.Matrix4).makeRotationAxis(new THREE.Vector3(0,0,1),Math.PI/4)),s.applyMatrix((new THREE.Matrix4).makeTranslation(-e.x-1.5*s.boundingBox.max.x,e.y+s.boundingBox.max.y,0))):1==E||5==E?(s.applyMatrix((new THREE.Matrix4).makeRotationAxis(new THREE.Vector3(0,0,1),Math.PI/2*3)),s.applyMatrix((new THREE.Matrix4).makeTranslation(-e.x-1.5*s.boundingBox.max.x,e.y-s.boundingBox.max.y,0))):s.applyMatrix(2==E||3==E?(new THREE.Matrix4).makeTranslation(-e.x-1.5*s.boundingBox.max.x,e.y+s.boundingBox.max.y,0):(new THREE.Matrix4).makeTranslation(-e.x-1.5*s.boundingBox.max.x,e.y+s.boundingBox.max.y,0)),m.merge(s),m},creatingMouth=function(e){var t=new THREE.ConeGeometry(2,1,28,10);t.applyMatrix((new THREE.Matrix4).makeRotationAxis(new THREE.Vector3(0,0,1),Math.PI));var a=new THREE.ConeGeometry(2.25,1.25,28,10),n=new THREE.BoxGeometry(2.5,1,2.5,8,6,8);n.applyMatrix((new THREE.Matrix4).makeRotationAxis(new THREE.Vector3(0,1,0),Math.PI/4));var r=new THREE.SphereGeometry(1.25,14,14),o=new THREE.CircleGeometry(1.5,30);o.applyMatrix((new THREE.Matrix4).makeRotationAxis(new THREE.Vector3(0,1,0),Math.PI));var i=new THREE.SphereGeometry(1.5,12,12,0,Math.PI);i.merge(o),i.applyMatrix((new THREE.Matrix4).makeRotationAxis(new THREE.Vector3(1,0,0),Math.PI/2)),i.computeFaceNormals(),i.computeVertexNormals();var x=new THREE.CylinderGeometry(.25,.25,3,10,16);x.applyMatrix((new THREE.Matrix4).makeRotationAxis(new THREE.Vector3(0,0,1),Math.PI/2));var E=new THREE.TorusGeometry(1,.15,8,26),m=new THREE.TorusGeometry(1.5,.25,8,26);m.applyMatrix((new THREE.Matrix4).makeRotationAxis(new THREE.Vector3(1,0,0),Math.PI/2));var s=[t,a,n,r,i,x,E,m],u=ATUtil.randomInt(0,s.length-1),y=s[0|u];return y.computeBoundingBox(),0==u?y.applyMatrix((new THREE.Matrix4).makeTranslation(0,e.y-3.5*y.boundingBox.max.y,0)):1==u?y.applyMatrix((new THREE.Matrix4).makeTranslation(0,e.y-2.5*y.boundingBox.max.y,0)):2==u?y.applyMatrix((new THREE.Matrix4).makeTranslation(0,e.y-3.5*y.boundingBox.max.y,0)):3==u?y.applyMatrix((new THREE.Matrix4).makeTranslation(0,e.y-1.5*y.boundingBox.max.y,0)):4==u?y.applyMatrix((new THREE.Matrix4).makeTranslation(0,e.y-.5*y.boundingBox.max.x,0)):5==u?y.applyMatrix((new THREE.Matrix4).makeTranslation(0,e.y-6*y.boundingBox.max.y,0)):6==u?y.applyMatrix((new THREE.Matrix4).makeTranslation(0,e.y-1.5*y.boundingBox.max.x,0)):7==u&&y.applyMatrix((new THREE.Matrix4).makeTranslation(0,e.y-.75*y.boundingBox.max.x,0)),y},createParticlesMesh=function(e,t){var a,n,r,o=new THREE.BufferGeometry,i=e.vertices.length,x=e.vertices,E=new Float32Array(3*i),m=new Float32Array(3*i);for(a=0,n=0;i>a;a++,n+=3)r=ATUtil.randomPointOnParticles(1+1.5*Math.random()),m[n]=r.x,m[n+1]=r.y,m[n+2]=r.z,E[n]=x[a].x,E[n+1]=x[a].y,E[n+2]=x[a].z;o.addAttribute("position",new THREE.BufferAttribute(m,3)),o.addAttribute("customPosition",new THREE.BufferAttribute(E,3).setDynamic(!0));var s=new THREE.Points(o,t);return s.geometry.attributes.customPosition.needsUpdate=!0,s.material.uniforms.scale.value=this.scale,s},createTrianglesMesh=function(e,t,a){var n,r,o,i=new THREE.BufferGeometry,x=e.vertices,E=e.vertices.length,m=new Float32Array(3*E*3),s=0;for(r=0,n=0;E>n;r+=3)r%9==0?(m[r]=x[n].x,m[r+1]=x[n].y,m[r+2]=x[n].z,n<t[s]||s++,n++):(o=ATUtil.randomInt(t[s-1],t[s]-1),m[r]=x[o].x*(.3*Math.random()+1),m[r+1]=x[o].y*(.3*Math.random()+1),m[r+2]=x[o].z*(.3*Math.random()+1));var u=3*E*4,y=new Uint8Array(3*E*4);for(r=0;u>r;r+=4)y[r]=255*Math.random(),y[r+1]=255*Math.random(),y[r+2]=255*Math.random(),y[r+3]=255*Math.random();i.addAttribute("position",new THREE.BufferAttribute(m,3)),i.addAttribute("color",new THREE.BufferAttribute(y,4,!0));var l=new THREE.Mesh(i,a);return l};Creature.prototype={constructor:Creature,update:function(e){var t,a=this._ribbons.length;for(t=0;a>t;t++)this._ribbons[t].update(e);this.creatureHolder.rotation.y=5e-4*e},switchState:function(){0==this.state?(this.state=1,this.creatureHolder.children[0].visible=!1,this.creatureHolder.children[1].visible=!0):(this.state=0,this.creatureHolder.children[0].visible=!0,this.creatureHolder.children[1].visible=!1)}};